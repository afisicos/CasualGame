import React, { useEffect, useRef } from 'react';
import { View, Text, Image, Animated, StatusBar, StyleSheet, Dimensions, Easing } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import Svg, { Path, Defs } from 'react-native-svg';
import { styles } from '../styles/SplashScreen.styles';

interface SplashScreenProps {
  onFinish: () => void;
}

const { width: SCREEN_WIDTH, height: SCREEN_HEIGHT } = Dimensions.get('window');

// Componente Logo SVG
const LogoSvg = ({ style }: { style?: any }) => (
  <Svg width="200" height="190" viewBox="0 0 399 379" style={style}>
    <Defs />
    <Path
      d="M 270.5,69.5 267.30078,81 c -1.8,6.3 -4,15.300391 -5,19.90039 -1.6,7.6 -2.10156,8.59922 -5.60156,11.19922 L 253,115 c -4.4,-9.7 -6.29961,-14.20078 -7.09961,-16.300781 C 245.10039,96.699219 244.3,95 244,95 c -0.3,0 -1.30039,6.89922 -2.40039,15.19922 -1,8.4 -2.19961,16.40078 -2.59961,17.80078 -0.3,1.4 -2.39961,3.69922 -4.59961,5.19922 -2.1,1.5 -6.50078,3.7 -9.80078,5 -3.2,1.3 -5.99883,2.70078 -6.29883,3.30078 -0.2,0.6 0.49961,2.8 1.59961,5 1.2,2.2 2.09961,4.7 2.09961,5.5 0,0.8 -3.3,6.2 -7.5,12 -7.1,10 -7.40039,10.7 -6.90039,15 0.3,2.5 0.90078,7.9 1.30078,12 0.4,4.1 1.1,8.30078 1.5,9.30078 0.5,1.5 -0.30039,1.69922 -8.90039,1.69922 -7.1,0 -9.39961,-0.29922 -9.09961,-1.19922 0.2,-0.7 0.9,-7 1.5,-14 L 195,174 c -10.2,-14.3 -13.59961,-18.59922 -14.09961,-18.69922 -0.5,-0.2 -3.20039,3.09922 -5.90039,7.19922 -3.5,5.2 -4.9,8.20078 -4.5,9.80078 0.3,1.2 1.2,6.29922 2,11.19922 0.8,4.9 2.39961,11.5 3.59961,14.5 1.2,3 2.70078,7.59961 3.30078,10.09961 0.9,3.8 2.19883,5.50117 8.29883,10.70117 L 195,225 c 12.4,0.1 13.8,-0.29961 15.5,-2.09961 1.1,-1.2 4.2,-3.80039 7,-5.90039 5,-3.7 5.00078,-3.79961 8.30078,-15.59961 1.8,-6.6 4.19922,-16.09961 5.19922,-21.09961 1.8,-8.1 1.79961,-9.7 0.59961,-12 -0.7,-1.6 -3,-4.9 -5,-7.5 -2,-2.7 -3.59961,-5.1 -3.59961,-5.5 0,-0.5 9.80039,-4.00078 21.90039,-7.80078 l 21.90039,-7 c 3.3,-10.8 4.09883,-14.2 3.79883,-14.5 -0.4,-0.3 -1.60039,0.49961 -2.90039,1.59961 -1.2,1.2 -4.8,3.9 -8,6 -3.1,2.2 -6.1,3.60117 -6.5,3.20117 -0.4,-0.4 3.70156,-5.3 9.10156,-11 L 272,115.5 c -0.2,-20.2 -0.50039,-30.5 -0.90039,-36 z m -138.58789,2.425781 c -0.39618,0.0872 -0.94063,5.54375 -1.3125,13.074219 -0.3,8 -0.59961,18.1 -0.59961,22.5 v 8 c 14.8,16.3 18.8,21.2 18.5,21.5 -0.3,0.3 -4.70078,-2.40039 -9.80078,-5.90039 -5.1,-3.6 -8.89961,-5.8 -8.59961,-5 0.3,0.8 1.60117,4.30039 2.70117,7.90039 L 135,140.5 c 12,3.6 21.89922,6.70078 29.69922,9.30078 7.9,2.6 14.40156,4.49922 14.60156,4.19922 0.1,-0.3 0.99844,-2.5 1.89844,-5 0.9,-2.5 1.90117,-5.2 2.20117,-6 0.5,-1.1 -1.6,-2.6 -8.5,-6 -5,-2.5 -9.70039,-5.2 -10.40039,-6 -0.8,-0.9 -2.3,-7.5 -3.5,-15.5 -1.1,-7.7 -2,-15.49922 -2,-17.199219 C 159,96.500781 158.69922,95 158.19922,95 c -0.4,0 -1.79961,2.599219 -3.09961,5.69922 -1.4,3.2 -3.29883,7.70156 -4.29883,10.10156 L 149,115 c -7.4,-5.2 -8,-6.2 -9,-11.5 -0.6,-3.3 -2.49922,-11.4 -4.19922,-18 C 134.20078,78.9 132.5,72.8 132,72 c -0.0281,-0.05625 -0.0579,-0.08081 -0.0879,-0.07422 z m 86.68721,104.468269 c 0.6,0 -1.48214,3.26994 -2.67551,4.90038 -1.88146,2.96888 -3.86809,7.75833 -3.86809,7.75833 0,0 0.0436,-3.85793 0.0436,-5.35793 0,-1.6 0.51336,-3.97629 0.91336,-4.47629 0.4,-0.6 1.54293,-1.09259 2.64293,-1.69259 1.1,-0.7 2.44371,-1.1319 2.94371,-1.1319 z m -35.48409,-0.0952 c 0.35977,0.0176 0.77305,0.0887 1.18555,0.20117 1.2,0.4 2.96888,0.83747 3.66888,1.83747 0.7,0.9 1.03034,3.96253 1.03034,10.16253 l -1.90039,-4 c -1,-2.2 -1.7682,-3.46157 -2.93708,-4.99337 C 182.81219,177.86225 182,177.09922 182,176.69922 c 0.0625,-0.3125 0.51562,-0.42969 1.11523,-0.40039 z M 164.40039,181 c -0.5,0.1 -4.39961,8.90078 -8.59961,19.80078 -4.3,10.8 -7.6,19.8 -7.5,20 0.1,0.1 3.79922,-1.80078 8.19922,-4.30078 4.4,-2.5 8.2,-4.39961 8.5,-4.09961 0.3,0.3 -1.90039,4.29883 -4.90039,8.79883 -3,4.6 -5.99922,9.30156 -6.69922,10.60156 -1.4,2.1 -0.70039,2.69922 16.59961,16.69922 9.9,8 18.29961,14.40078 18.59961,14.30078 0.3,-0.2 -3,-12.20078 -7.5,-26.80078 -4.4,-14.6 -9.70039,-32.89922 -11.90039,-40.69922 -2.1,-7.9 -4.29883,-14.30078 -4.79883,-14.30078 z m 74.75195,0.7793 c -0.49281,0.016 -2.43007,5.47812 -4.55273,12.52148 -2.1,7.2 -7.59883,25.59922 -12.29883,40.69922 -4.7,15.1 -8.70039,27.80078 -8.90039,28.30078 -0.2,0.4 -0.20039,0.69922 0.0996,0.69922 0.3,0 8.6,-6.5 18.5,-14.5 9.9,-8 18,-15.09922 18,-15.69922 0,-0.7 -2.7,-5.80078 -6,-11.30078 -3.33359,-5.39258 -5.70309,-9.92236 -5.51172,-10.19141 l 0.008,-0.008 c 10e-4,-5.3e-4 0.003,3.9e-4 0.004,0 0.3,-0.2 3.99922,1.69922 8.19922,4.19922 4.23281,2.46094 7.79098,4.43625 8.0918,4.30664 0.001,-5.8e-4 0.005,-0.003 0.006,-0.004 8.8e-4,-7.1e-4 0.003,-0.001 0.004,-0.002 0.2,-0.2 -3.10078,-8.90078 -7.30078,-19.30078 -4.2,-10.4 -8.00078,-19.29922 -8.30078,-19.69922 -0.0141,-0.0141 -0.0289,-0.0221 -0.0469,-0.0215 z M 200.5,206 c 3.5,0 5.17109,-0.12571 5.18639,1.66307 0.009,1.04371 0.0722,2.92137 -0.003,3.61839 C 205.61216,211.94845 203.8,212 201,212 c -4.9,0 -5,-0.1 -5,-3 0,-2.9 0.2,-3 4.5,-3 z m -136,91.09961 c -3.3,0 -7.500391,0.60078 -9.400391,1.30078 -1.9,0.7 -4.2,2.3 -5,3.5 -1,1.5 -1.7,5.2 -2,10 -0.2,5.6 0.100782,8.50039 1.300782,10.90039 0.9,1.9 2.999609,3.79922 5.099609,4.69922 2,0.8 6.399219,1.5 10.199219,1.5 3.8,0 7.8,-0.2 9,-0.5 C 75.499219,328.1 76,327.3 76,325 v -3 C 59.8,322.5 58.700391,322.3 57.400391,320.5 56.600391,319.4 56,316.30078 56,313.30078 c 0,-4.2 0.499219,-5.8 2.199219,-7.5 2.1,-1.9 3.201562,-2.10117 10.101562,-1.70117 L 76.099609,304.5 C 75.599609,299.4 74.8,298.40039 73,297.90039 c -1.4,-0.4 -5.2,-0.70078 -8.5,-0.80078 z m 129,0 c -2.8,0 -6.50039,0.50117 -8.40039,1.20117 -1.9,0.7 -4.4,2.5 -5.5,4 -1.7,2.3 -2.09961,4.29961 -2.09961,10.59961 0,5.1 0.5,8.7 1.5,10.5 0.8,1.5 3.1,3.39883 5,4.29883 2.1,1 6.1,1.60156 10,1.60156 4.1,0 7.69922,-0.60156 9.69922,-1.60156 1.8,-1 4.00078,-3.09922 4.80078,-4.69922 0.9,-1.8 1.5,-5.79922 1.5,-9.69922 0,-5.5 -0.40078,-7.50078 -2.30078,-10.30078 -1.3,-2.1 -3.69922,-3.99922 -5.69922,-4.69922 -1.9,-0.7 -5.8,-1.20117 -8.5,-1.20117 z m 111.82422,0.16211 c -1.675,0.0625 -2.92422,0.18789 -3.32422,0.33789 -0.8,0.3 -2.60039,1.10117 -3.90039,1.70117 -1.3,0.7 -2.99883,2.7 -3.79883,4.5 C 293.60078,305.50078 293,309.7 293,313 c 0,3.3 0.7,7.6 1.5,9.5 1,2.4 2.69922,3.99961 5.19922,5.09961 2.8,1.2 6,1.50078 12,1.30078 4.5,-0.2 8.40078,-0.60039 8.80078,-0.90039 0.4,-0.3 0.39961,-1.69922 0.0996,-3.19922 -0.6,-2.8 -0.60039,-2.80117 -6.90039,-2.20117 -4.2,0.5 -6.99922,0.30039 -8.69922,-0.59961 -1.4,-0.7 -2.79922,-1.80039 -3.19922,-2.40039 -0.4,-0.6 -0.80078,-3.49883 -0.80078,-6.29883 0,-4 0.5,-5.80078 2,-7.30078 1.7,-1.7 3.1,-1.99922 9.5,-1.69922 7.4,0.2 7.59961,0.0992 8.09961,-2.30078 0.3,-1.4 0.10039,-2.9 -0.59961,-3.5 -0.6,-0.6 -4.60078,-1.09922 -8.80078,-1.19922 -2.1,-0.1 -4.2,-0.10156 -5.875,-0.0391 z M 247.5,297.90039 c -6.5,0.1 -8.60039,0.40039 -8.90039,0.90039 -0.2,0.4 -3.2,6.99922 -6.5,14.69922 -3.4,7.7 -6.09961,14.30078 -6.09961,14.80078 0,0.4 1.6,0.69922 3.5,0.69922 2.9,0 3.8,-0.5 5,-3 1.5,-2.9 1.7,-3 9,-3 7.4,0 7.5,0 8.5,3 0.9,2.7 1.4,3 5,3 2.2,0 4,-0.2 4,-0.5 0,-0.3 -3.00078,-7.3 -6.80078,-15.5 z M 82,298 v 15.5 15.5 h 26 v -7 H 90 v -6 h 16 v -6 H 90 v -6 h 18 v -6 z m 29,0 v 3 c 0,2.9 0.0992,3.00078 5.19922,3.30078 L 121.5,304.5 122,329 h 7 v -25 c 10.9,0 11,0 11,-3 v -3 z m 33,0 v 15.5 15.5 h 8 c 0,-8.8 0.1,-9 3,-9 2.4,0 3.59922,0.9 6.19922,4.5 3,4.2 3.6,4.5 7.5,4.5 3.1,0 4.10117,-0.29922 3.70117,-1.19922 -0.4,-0.7 -1.8,-2.8 -3,-4.5 L 167,320 c 3.9,-4.3 5.29961,-7.1 5.59961,-9 0.4,-2.2 0,-4.89922 -1,-7.19922 -0.9,-2.2 -2.69961,-4.20078 -4.09961,-4.80078 -1.4,-0.6 -7.2,-1 -13,-1 z m 122.19922,0 -0.39844,11.80078 c -0.2,6.4 -0.20156,13.4 -0.10156,15.5 L 266,329 h 24 v -7 H 273 V 298 Z M 327,298.09961 v 15.5 15.5 h 26 v -7 h -19 c 0.5,-5.5 0.49922,-5.59883 8.69922,-5.79883 L 351,316.09961 v -6 h -17 v -6 h 19 v -6 z M 152,304 h 5 c 3.1,0 5.6,0.6 6.5,1.5 0.8,0.8 1.5,2 1.5,2.5 0,0.6 -0.4,1.9 -1,3 -0.8,1.6 -2,2 -12,2 v -4.5 z m 41.80078,0 c 3.1,0 5.3,0.60078 6.5,1.80078 1.3,1.2 1.79922,3.19922 1.69922,7.19922 0,3.2 -0.60039,6.4 -1.40039,7.5 -1.1,1.6 -2.6,2 -7,2 -3.2,0 -5.99883,-0.50078 -6.79883,-1.30078 -0.7,-0.7 -1.50117,-3.9 -1.70117,-7 -0.3,-4.8 -0.0988,-6.09844 1.70117,-7.89844 1.7,-1.8 3.3,-2.30078 7,-2.30078 z m 49.39844,3 c 0.4,0 1.20117,1.20078 1.70117,2.80078 0.5,1.5 1.2,3.5 1.5,4.5 C 246.90039,315.70078 246.4,316 239,316 l 1.69922,-4.5 c 0.9,-2.5 2,-4.5 2.5,-4.5 z"
      fill="#19344c"
    />
    <Path
      d="m 198.5,93.7 c -0.9,2.1 -3,6.6 -4.6,10 -1.6,3.5 -3.2,6.3 -3.7,6.3 -0.4,0 -3,-2.6 -5.9,-5.8 l -5.2,-5.7 c 0,5.4 0.6,10.6 1.2,15 l 1.2,8 h 38.9 c 1.8,-12.4 2.6,-17.8 3,-20 l 0.7,-4 -12.9,13 c -2.1,-3.9 -4,-8.3 -5.7,-12.4 -1.6,-4.1 -3.5,-7.6 -4.2,-7.9 -0.6,-0.2 -1.9,1.4 -2.8,3.5 z m -84.5,4 c 0,5.8 0.3,7.1 2.2,8.8 1.3,1.2 3.1,2.7 4.1,3.5 1.7,1.4 1.8,1 1.7,-7.3 0,-8.7 0,-8.7 -3,-10.2 -1.7,-0.8 -3.5,-1.5 -4,-1.5 -0.6,0 -1,2.9 -1,6.7 z m 169.1,-5.2 -3.4,1.4 c 0.2,12.5 0.6,16.1 1.1,16.1 0.4,0 2.2,-1.2 4,-2.5 3.1,-2.4 3.2,-2.8 3.2,-9.5 0,-3.8 -0.3,-7 -0.7,-7 -0.5,0.1 -2.3,0.7 -4.2,1.5 z M 112,121 v 5 c 9.3,4.7 12.2,6 12.5,6 0.3,0 -0.9,-2.6 -2.6,-5.8 -1.7,-3.1 -4.1,-6.7 -5.3,-8 -1.1,-1.2 -2.7,-2.2 -3.3,-2.2 -0.86667,0 -1.3,1.66667 -1.3,5 z m 171.5,-1.8 c -1.5,1.8 -3.9,5.2 -5.4,7.6 -1.4,2.3 -2.4,4.4 -2.1,4.6 0.3,0.2 3.3,-1 6.8,-2.5 5.4,-2.5 6.2,-3.2 6.2,-5.7 0,-1.5 -0.2,-3.7 -0.4,-5 -0.1,-1.2 -0.8,-2.2 -1.4,-2.2 -0.6,0 -2.3,1.5 -3.7,3.2 z M 182,126 c 0,1.9 0.7,2 19,2 18.3,0 19,-0.1 19,-2 0,-1.9 -0.7,-2 -19,-2 -18.3,0 -19,0.1 -19,2 z m 6.6,14.2 c -1.9,4 -3.6,8.2 -4,9.3 -0.5,1.5 1.3,4.8 6.8,12.5 l 7.5,10.5 c -1.4,14.7 -2.2,20.9 -2.6,23.3 l -0.8,4.2 c 3.99891,0.0282 10.97848,-0.0549 10.97848,-0.0549 C 205.93796,194.88826 205.5,191.1 204.9,184.5 l -1.1,-12 c 11,-16.3 14.2,-21.4 14.2,-22 0,-0.6 -1.8,-4.7 -4,-9.3 l -4,-8.2 h -18.1 z m 57.9,15.2 c -5,1.8 -10.4,4 -12.2,4.9 -3.2,1.6 -3.2,1.7 -1.5,3.7 0.9,1.1 3.8,2.7 6.2,3.5 l 4.5,1.5 c 5.9,-6.6 8.8,-10.2 10.3,-12.3 1.5,-2.1 2.5,-4 2.2,-4.2 -0.4,-0.2 -4.6,1.1 -9.5,2.9 z m -99.3,-1.8 c -0.1,0.5 2.4,4 5.4,7.8 3.1,3.9 5.8,7.3 6,7.5 0.3,0.3 2.4,-0.2 4.7,-1.2 2.3,-0.9 5.1,-2.6 6.2,-3.8 1.8,-1.8 1.8,-2.2 0.5,-3 -0.8,-0.5 -5.1,-2.3 -9.5,-4 -4.4,-1.7 -9.1,-3.4 -10.6,-3.7 -1.4,-0.3 -2.6,-0.1 -2.7,0.4 z m 37,72.3 c -0.1,0.6 2.5,8.8 5.8,18.3 3.4,9.5 6.3,17.5 6.5,17.7 0.3,0.3 0.7,0.3 1,0 0.2,-0.2 0.7,-6.8 1.1,-14.5 l 0.7,-14 c -6.8,-3.4 -10.2,-5.3 -11.8,-6.5 -1.8,-1.2 -3.2,-1.7 -3.3,-1 z m 27.6,3.4 -6.7,4.1 c 0.1,12.5 0.5,19 0.8,22.6 0.5,5.5 0.8,6.2 1.8,4.4 0.6,-1.1 3.4,-8.5 6.2,-16.5 2.7,-7.9 5.2,-15.5 5.4,-16.7 0.2,-1.2 0.2,-2.2 -0.2,-2.2 -0.3,0.1 -3.6,2 -7.3,4.3 z"
      fill="#e1af5b"
    />
    <Path
      d="m 177.7,164 c -1.5,2.2 -2.5,4.7 -2.2,5.5 0.3,0.8 2.2,1.9 4.3,2.5 2,0.5 4.7,1 6,1 2.2,0 2.2,0 -0.9,-5.8 -1.7,-3.1 -3.4,-6.1 -3.8,-6.5 -0.4,-0.4 -1.9,1 -3.4,3.3 z m 41.2,1.4 c -1.8,2.9 -3.2,5.9 -3.1,6.5 0.1,0.6 1,1.1 2,1.1 0.9,0 3.3,-0.5 5.2,-1.1 1.9,-0.7 3.9,-1.5 4.5,-2 0.6,-0.5 0,-2.5 -1.7,-5.3 -1.6,-2.5 -3,-4.6 -3.2,-4.6 -0.3,0 -1.9,2.4 -3.7,5.4 z m 4.4,12.9 c -3.2,2.4 -4.1,3.7 -3.6,5.2 0.3,1.1 1.5,4 2.6,6.5 l 1.9,4.5 c 3.7,-14.7 4.7,-19.1 4.8,-19.3 0,-0.1 -0.3,-0.2 -0.7,-0.2 -0.5,0 -2.7,1.5 -5,3.3 z M 175,178.2 c 0,1.3 0.5,5 1.1,8.3 0.6,3.3 1.4,6.3 1.7,6.8 0.4,0.4 1.9,-2 3.5,-5.3 l 2.7,-6 c -6.2,-4.7 -8.2,-6 -8.5,-6 -0.3,0 -0.5,1 -0.5,2.2 z m 38.7,12.5 c -1.6,6 -1.6,7.3 -0.4,10.8 0.8,2.2 2.2,5.6 3.1,7.5 1.1,2.1 2.1,3.1 2.6,2.5 0.5,-0.6 1.5,-3.7 2.3,-7 1.5,-5.9 1.5,-6.1 -1.3,-13 -1.6,-3.8 -3.3,-7.1 -3.7,-7.3 -0.5,-0.1 -1.6,2.8 -2.6,6.5 z m -29.6,-1.5 c -0.5,1.3 -1.6,4 -2.5,6 -1.5,3.5 -1.5,4.3 0,9.5 0.9,3.2 2,6.2 2.4,6.8 0.5,0.6 2,-1.2 3.6,-4.5 2.1,-4.4 2.5,-6.4 2.1,-10 -0.3,-2.5 -1.1,-5.8 -1.9,-7.3 -0.7,-1.5 -1.6,-2.7 -2.1,-2.7 -0.4,0 -1.1,1 -1.6,2.2 z m 8.2,19 c -1.1,1.3 -2.5,3.2 -3.2,4.3 -0.8,1.6 -0.7,2.3 0.9,3.7 1.5,1.4 2.5,1.6 4,0.8 1.6,-0.8 2,-2 2,-6 0,-2.8 -0.4,-5 -0.8,-5 -0.5,0 -1.8,1 -2.9,2.2 z m 13.6,-0.45332 c -0.0192,1.21259 0.0556,1.51191 0.12152,3.26293 0.1096,1.42882 0.34073,2.56292 0.88741,3.80961 0.71854,1.1682 1.90595,2.04005 4.19702,2.18078 1.39737,0.0858 3.19405,-0.6 3.49405,-1.3 0.3,-0.6 -0.2,-2.7 -1,-4.5 -0.9,-1.7 -2.38742,-3.09337 -3.6,-3.94668 -1.0247,-0.7211 -2.50298,-1.45035 -3.40298,-1.45035 -0.4119,0 -0.68078,0.48444 -0.69702,1.94371 z"
      fill="#e1af5b"
    />
  </Svg>
);

// Generamos una lista más amplia de ingredientes con configuraciones únicas
const INGREDIENT_ASSETS = [
  require('../assets/Ingredientes/bread.png'),
  require('../assets/Ingredientes/meat.png'),
  require('../assets/Ingredientes/cheese.png'),
  require('../assets/Ingredientes/lettuce.png'),
  require('../assets/Ingredientes/tomato.png'),
  require('../assets/Ingredientes/bacon.png'),
  require('../assets/Ingredientes/pickle.png'),
  require('../assets/Ingredientes/onion.png'),
  require('../assets/Ingredientes/ketchup.png'),
];

// Creamos 25 ingredientes optimizados para evitar ralentizaciones
const fallingItems = Array.from({ length: 25 }).map((_, i) => ({
  id: i,
  source: INGREDIENT_ASSETS[i % INGREDIENT_ASSETS.length],
  // Posición horizontal repartida aleatoriamente en píxeles
  left: Math.random() * SCREEN_WIDTH,
  // Duraciones variadas para romper la sincronía (más cortas para mejor rendimiento)
  duration: 3000 + Math.random() * 1000,
  // Duración de la rotación simplificada
  rotateDuration: 4000 + Math.random() * 2000,
  // POSICIÓN INICIAL: Fuera de la pantalla arriba, escalonada
  startY: -150 - (i * 60),
  // Tamaños optimizados (menos variedad)
  size: i % 2 === 0 ? 40 : 60,
  // Opacidades consistentes (menos cálculo)
  opacity: 0.3 + (i % 3) * 0.2,
  zIndex: i % 2,
}));

const AnimatedIngredient: React.FC<{ item: typeof fallingItems[0] }> = ({ item }) => {
  const translateY = useRef(new Animated.Value(item.startY)).current;
  // Empezamos en un ángulo aleatorio
  const rotate = useRef(new Animated.Value(Math.random())).current;

  useEffect(() => {
    // Rotación simplificada: una sola vuelta completa
    Animated.loop(
      Animated.timing(rotate, {
        toValue: 1,
        duration: item.rotateDuration,
        easing: Easing.linear,
        useNativeDriver: true,
      })
    ).start();

    // Caída simplificada
    const runFall = () => {
      Animated.timing(translateY, {
        toValue: SCREEN_HEIGHT + 200,
        duration: item.duration,
        easing: Easing.linear,
        useNativeDriver: true,
      }).start(({ finished }) => {
        if (finished) {
          translateY.setValue(-200);
          runFall(); // Reiniciar la caída
        }
      });
    };

    runFall();

    return () => {
      translateY.stopAnimation();
      rotate.stopAnimation();
    };
  }, [item]);

  // La interpolación 'extend' permite que el giro sea infinito sin saltos
  const rotation = rotate.interpolate({
    inputRange: [0, 1],
    outputRange: ['0deg', '360deg'],
  });

  const animatedStyle = {
    position: 'absolute' as const,
    left: item.left,
    transform: [
      { translateY },
      { rotate: rotation }
    ],
    opacity: item.opacity,
    zIndex: item.zIndex,
  };

  return (
    <Animated.View style={animatedStyle}>
      <Image source={item.source} style={{ width: item.size, height: item.size }} resizeMode="contain" />
    </Animated.View>
  );
};

const SplashScreen: React.FC<SplashScreenProps> = ({ onFinish }) => {
  const insets = useSafeAreaInsets();
  const fadeAnim = useRef(new Animated.Value(0)).current;
  const scaleAnim = useRef(new Animated.Value(0.5)).current;
  const translateYAnim = useRef(new Animated.Value(600)).current;

  useEffect(() => {
    // Entrada del título
    Animated.sequence([
      Animated.parallel([
        Animated.timing(fadeAnim, { toValue: 1, duration: 800, useNativeDriver: true }),
        Animated.timing(translateYAnim, { toValue: 0, duration: 1000, useNativeDriver: true }),
        Animated.timing(scaleAnim, { toValue: 0.9, duration: 1000, useNativeDriver: true }),
      ]),
      Animated.spring(scaleAnim, {
        toValue: 1,
        friction: 3,
        tension: 100,
        useNativeDriver: true,
      }),
    ]).start();

    // Salida
    const timer = setTimeout(() => {
      Animated.timing(fadeAnim, { toValue: 0, duration: 500, useNativeDriver: true }).start(() => {
        onFinish();
      });
    }, 2000); // 2 segundos optimizados

    return () => clearTimeout(timer);
  }, []);

  return (
    <View style={[styles.container, { paddingTop: insets.top }]}>
      <StatusBar translucent backgroundColor="transparent" barStyle="light-content" />
      <LinearGradient colors={['#FF9966', '#FF5E62']} style={StyleSheet.absoluteFill} />
      
      {/* Lluvia constante de ingredientes */}
      {fallingItems.map((item) => (
        <AnimatedIngredient key={item.id} item={item} />
      ))}

      {/* Título centrado */}
      <Animated.View style={[
        styles.content,
        {
          opacity: fadeAnim,
          transform: [{ scale: scaleAnim }, { translateY: translateYAnim }],
          zIndex: 10,
        }
      ]}>
        <Image source={require('../assets/Iconos/Titulo.png')} style={styles.logo} resizeMode="contain" />
      </Animated.View>
    </View>
  );
};

export default SplashScreen;
